<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prisoner's Dilemma Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e6f0ff;
      color: #000;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }
    .btn {
      padding: 10px 20px;
      margin: 10px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
    }
    .cooperate { background-color: #3399ff; color: white; }
    .betray { background-color: #003366; color: white; }
    #startSection, #gameSection, #resultSection { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <div id="startSection">
      <h1>Prisoner's Dilemma</h1>
      <p>
        Welcome to the Prisoner’s Dilemma – a psychological strategy game.  
        You and a bot will each decide in 10 rounds whether to <strong>cooperate</strong> or <strong>betray</strong>.  
        Your goal is <strong>not to win</strong>, but to score as many points as possible.
      </p>
      <p>
        <strong>Points system:</strong><br>
        – Both cooperate: <strong>3 points each</strong><br>
        – You cooperate, bot betrays: <strong>You get 0, bot gets 5</strong><br>
        – You betray, bot cooperates: <strong>You get 5, bot gets 0</strong><br>
        – Both betray: <strong>1 point each</strong>
      </p>
      <p>Click below to begin. Choose wisely.</p>
      <button class="btn cooperate" onclick="startGame()">I understand. Start game</button>
    </div>

    <div id="gameSection">
      <h2>Round <span id="roundNumber">1</span>/10</h2>
      <p>Choose your action:</p>
      <button class="btn cooperate" onclick="playRound('cooperate')">Cooperate</button>
      <button class="btn betray" onclick="playRound('betray')">Betray</button>
      <p id="roundResult"></p>
    </div>

    <div id="resultSection">
      <h2>Game Over</h2>
      <p id="finalResult"></p>
      <button class="btn cooperate" onclick="downloadLog()">Download Game Report</button>
    </div>
  </div>

  <script>
    const totalRounds = 10;
    let currentRound = 1;
    let playerScore = 0;
    let playerCooperations = 0;
    const colorCode = "#3399ff";
    const colorName = "Blue";
    let log = [];

    document.getElementById("startSection").style.display = "block";

    function startGame() {
      document.getElementById("startSection").style.display = "none";
      document.getElementById("gameSection").style.display = "block";
    }

    function playRound(playerMove) {
      const botMove = Math.random() < 0.5 ? 'cooperate' : 'betray';
      let roundPoints = 0;

      if (playerMove === 'cooperate' && botMove === 'cooperate') {
        roundPoints = 3;
        playerScore += 3;
        playerCooperations++;
      } else if (playerMove === 'cooperate' && botMove === 'betray') {
        roundPoints = 0;
        playerCooperations++;
      } else if (playerMove === 'betray' && botMove === 'cooperate') {
        roundPoints = 5;
        playerScore += 5;
      } else if (playerMove === 'betray' && botMove === 'betray') {
        roundPoints = 1;
        playerScore += 1;
      }

      log.push({
        round: currentRound,
        player: playerMove,
        bot: botMove,
        playerPoints: roundPoints
      });

      document.getElementById("roundResult").textContent = 
        `You chose "${playerMove}", bot chose "${botMove}". You earned ${roundPoints} point(s).`;

      currentRound++;

      if (currentRound > totalRounds) {
        endGame();
      } else {
        document.getElementById("roundNumber").textContent = currentRound;
      }
    }

    function endGame() {
      document.getElementById("gameSection").style.display = "none";
      document.getElementById("resultSection").style.display = "block";

      const cooperationRate = (playerCooperations / totalRounds * 100).toFixed(2);
      const summary = `You finished the game with ${playerScore} total points and cooperated ${playerCooperations} times (${cooperationRate}%).`;
      document.getElementById("finalResult").textContent = summary;
    }

    function downloadLog() {
      const timestamp = new Date().toISOString();
      const cooperationRate = (playerCooperations / totalRounds * 100).toFixed(2);

      const result = {
        timestamp,
        colorHex: colorCode,
        colorName: colorName,
        totalPoints: playerScore,
        cooperations: playerCooperations,
        cooperationRate: `${cooperationRate}%`,
        rounds: log
      };

      const blob = new Blob([JSON.stringify(result, null, 2)], { type: 'application/json' });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `prisoners_dilemma_${timestamp.replace(/[:.]/g, '-')}.json`;
      a.click();
    }
  </script>
</body>
</html>
